<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Django-rest-encrypted-lookup by InterSIS</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <script src="javascripts/scale.fix.js"></script>
      <meta prefix="og: http://ogp.me/ns#" property="og:image" content="images/graph-image.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">Django-rest-encrypted-lookup</h1>
        <p class="header"></p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/InterSIS/django-rest-encrypted-lookup/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/InterSIS/django-rest-encrypted-lookup/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/InterSIS/django-rest-encrypted-lookup">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/InterSIS">InterSIS</a></p>


      </header>
      <section>
        <p><a href="https://travis-ci.org/InterSIS/django-rest-encrypted-lookup"><img src="https://travis-ci.org/InterSIS/django-rest-encrypted-lookup.svg?branch=master" alt="Build Status"></a>
<a href="https://codeclimate.com/github/InterSIS/django-rest-encrypted-lookup"><img src="https://codeclimate.com/github/InterSIS/django-rest-encrypted-lookup/badges/gpa.svg" alt="Code Climate"></a>
<a href="https://coveralls.io/github/InterSIS/django-rest-encrypted-lookup?branch=master"><img src="https://coveralls.io/repos/InterSIS/django-rest-encrypted-lookup/badge.svg?branch=master&amp;service=github" alt="Coverage Status"></a>
<a href="http://badge.fury.io/py/django-rest-encrypted-lookup"><img src="https://badge.fury.io/py/django-rest-encrypted-lookup.svg" alt="PyPI version"></a></p>

<h1>
<a id="django-rest-encrypted-lookup" class="anchor" href="#django-rest-encrypted-lookup" aria-hidden="true"><span class="octicon octicon-link"></span></a>django-rest-encrypted-lookup</h1>

<p>Drop-in ViewSets, Serializers, and Fields that replace your IntegerField pk or id lookups with encrypted string lookups. </p>

<p>Use a single cipher across your entire project, or provide a unique cipher for each serializer, model, user, and/or client.</p>

<p>The json representation of a poll:</p>

<pre><code>    {
        "id": 5,
        "questions": [
                      2,
                      10,
                      12,
        ]
    }
</code></pre>

<p>becomes:</p>

<pre><code>    {
        "id": "4xoh7gja2mtvz3i47ywy5h6ouu",
        "questions": [
                      "t6y4zo26vutj4xclh5hpy3sc5m",
                      "hp7c75ggggiwv6cs5zc4mpzeoe",
                      "rqq5a2evfokyo7tz74loiu3bcq",
        ]
    }
</code></pre>

<p>Choose a user-by-user cipher such that:</p>

<pre><code>    # User A GETs /api/polls/ and receives:

    {
        "results": [
                    "4xoh7gja2mtvz3i47ywy5h6ouu",
                    "12gc75ggggiwv6cs5zc4mpzeoe",
        ]
    }

    # User B GETs /api/polls/ and receives:

    {
        "results": [
                    "rqq5a2evfokyo7tz74loiu3bcq",
                    "hp7c75g84g63v6cs5zc423zeoe",
        ]
    }
</code></pre>

<p>If you prefer hyperlinked related fields:</p>

<pre><code>    {
        "id": "4xoh7gja2mtvz3i47ywy5h6ouu",
        "questions": [
                      "https://example.com/api/questions/t6y4zo26vutj4xclh5hpy3sc5m/",
                      "https://example.com/api/questions/hp7c75ggggiwv6cs5zc4mpzeoe/",
                      "https://example.com/api/questions/rqq5a2evfokyo7tz74loiu3bcq/",
        ]
    }
</code></pre>

<p>The endpoint:</p>

<pre><code>    /api/polls/5/
</code></pre>

<p>becomes:</p>

<pre><code>    /api/polls/4xoh7gja2mtvz3i47ywy5h6ouu/
</code></pre>

<p>Encrypted lookups are <em>not</em> appropriate to use as a security measure against users guessing object URIs. Encrypted
lookups <em>are</em> appropriate to use as a method of obfuscating object pks/ids.</p>

<h1>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h1>

<p>Install the module in your Python distribution or virtualenv:</p>

<pre><code>$ pip install django-rest-encrypted-lookup
</code></pre>

<p>Add the application to your <code>INSTALLED_APPS</code>:</p>

<pre><code>  INSTALLED_APPS = (
  ...
  "rest_framework_encrypted_lookup",
  ...
  )
</code></pre>

<p>And in settings.py:</p>

<pre><code>  ENCRYPTED_LOOKUP = {
      'lookup_field_name': 'id',  # String value name of your drf lookup field, generally 'id' or 'pk'
      'secret_key': 'uniquesecret',  # Choose a string value unique secret key with which to encrypt your lookup fields
  },
</code></pre>

<h1>
<a id="how-it-works" class="anchor" href="#how-it-works" aria-hidden="true"><span class="octicon octicon-link"></span></a>How it Works</h1>

<p>Encrypted lookup strings are <em>not</em> stored in the database in association with the objects they represent. Encrypted
lookups are generated by the model serializers during response composition. Encrypted lookups presented in the endpoint
URI are decrypted in the call to dispatch, and encrypted lookups presented in data fields are decrypted by the model
deserializers.</p>

<p>Encryption is provided by the PyCrypto AES library.</p>

<h1>
<a id="use" class="anchor" href="#use" aria-hidden="true"><span class="octicon octicon-link"></span></a>Use</h1>

<p>django-rest-encrypted-lookup provides three field classes:</p>

<pre><code>from rest_framework_encrypted_lookup.fields import EncryptedLookupField, EncryptedLookupRelatedField, EncryptedLookupHyperlinkedRelatedField
</code></pre>

<p>two new serializer classes:</p>

<pre><code>from rest_framework_encrypted_lookup.serializers import EncryptedLookupModelSerializer, EncryptedLookupHyperlinkedModelSerializer
</code></pre>

<p>and a generic view class:</p>

<pre><code>from rest_framework_encrypted_lookup.views import EncryptedLookupGenericViewSet
</code></pre>

<p>Use these in place of the classes provided with Django Rest Framework 3.</p>

<p>Example:</p>

<pre><code>    # models.py
    ...
    class Poll(models.Model):
        ...


    # serializers.py
    ...
    class PollSerializer(EncryptedLookupModelSerializer):

        class Meta:
            model = Poll


    # views.py
    ...
    from rest_framework import viewsets

    class PollViewSet(EncryptedLookupGenericViewSet,
                      viewsets.mixins.ListModelMixin,
                      viewsets.mixins.RetrieveModelMixin,
                      ...
                     )

        queryset = Poll.objects.all()
        serializer_class = PollSerializer

        lookup_field = 'id'


    # urls.py
    ...
    from rest_framework import router
    from polls import views

        router = routers.SimpleRouter()
        router.register(r'polls', views.PollViewSet)

        urlpatterns = [
            url(r'^admin/', include(admin.site.urls)),
            url(r'^', include(router.urls)),
        ]


</code></pre>

<p>Of the classes included in this package, the example above makes use of <code>EncryptedLookupModelSerializer</code>, and 
<code>EncryptedLookupGenericViewSet</code>.</p>

<p>The fields <code>EncryptedLookupField</code>, <code>EncryptedLookupRelatedField</code> are used implicitly
by the EncryptedLookupModelSerializer. These fields may also be used explicitly, if needed.</p>

<p>We could have used <code>EncryptedLookupHyperlinkedModelSerializer</code> instead of <code>EncryptedLookupModelSerializer</code>:</p>

<pre><code>    # serializers.py
    ...
    class PollSerializer(EncryptedLookupHyperlinkedModelSerializer):

        class Meta:
            model = Poll
</code></pre>

<p>In this case, PollSerializer would serialize related fields as hyperlinks, using the <code>EncryptedHyperlinkedLookupRelatedField</code>.</p>

<p>By default, every encrypted-lookup serializer class will use the same cypher. You can choose a non-default cypher by
overwriting your serializer's <code>get_cypher</code> method. Here is a <code>get_cypher</code> method that will produce a unique cypher per-model:</p>

<pre><code>    from rest_framework_encrypted_lookup.utils import IDCipher
    from rest_framework_encrypted_lookup.settings import encrypted_lookup_settings

    class MyEncryptedLookupModelSerializer(EncryptedLookupModelSerializer):

        def get_cipher(self):
            return IDCipher(secret=encrypted_lookup_settings['secret_key']+self.Meta.model)

</code></pre>

<p>Here is a <code>get_cypher</code> method that will produce a unique cypher per-user:</p>

<pre><code>    from rest_framework_encrypted_lookup.utils import IDCipher
    from rest_framework_encrypted_lookup.settings import encrypted_lookup_settings

    class MyEncryptedLookupModelSerializer(EncryptedLookupModelSerializer):

        def get_cipher(self):
            # Let's suppose that a user must be logged in to reach this endpoint.

            return IDCipher(secret=encrypted_lookup_settings['secret_key']+self._context["request"].user.username)

</code></pre>

<h1>
<a id="compatibility" class="anchor" href="#compatibility" aria-hidden="true"><span class="octicon octicon-link"></span></a>Compatibility</h1>

<ul>
<li>Django Rest Framework 3.0, 3.1</li>
<li>Django 1.6, 1.7, 1.8</li>
<li>Python 2.7, 3.3, 3.4</li>
</ul>

<p>See tox.ini for specific minor versions tested.</p>

<h1>
<a id="additional-requirements" class="anchor" href="#additional-requirements" aria-hidden="true"><span class="octicon octicon-link"></span></a>Additional Requirements</h1>

<ul>
<li>PyCrypto 2.6.1</li>
</ul>

<h1>
<a id="todo" class="anchor" href="#todo" aria-hidden="true"><span class="octicon octicon-link"></span></a>Todo</h1>

<ul>
<li>Helpful exceptions.</li>
<li>Coverage.</li>
</ul>

<h1>
<a id="getting-involved" class="anchor" href="#getting-involved" aria-hidden="true"><span class="octicon octicon-link"></span></a>Getting Involved</h1>

<p>Feel free to open pull requests or issues. <a href="https://github.com/InterSIS/django-rest-encrypted-lookup">GitHub</a> is the canonical location of this project.</p>

<p>Here's the general sequence of events for contribution:</p>

<ol>
<li>Open an issue in the <a href="https://github.com/InterSIS/django-rest-encrypted-lookup/issues/">issue tracker</a>.</li>
<li>In any order:

<ul>
<li>Submit a pull request with a <strong>failing</strong> test that demonstrates the issue/feature.</li>
<li>Get acknowledgement/concurrence.</li>
</ul>
</li>
<li>Submit pull request that passes your test in (2). Include documentation, if appropriate.</li>
</ol>
      </section>
      <footer>
        <p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>
